\subsubsection{Soils}\label{sec:soils}
Soils are a critical part of the SWAT modeling framework; they determine many
surface hydraulic properties such as texture, hydraulic conductivity, and
available water capacity. We used the county-scale Soil Survey Geographical
Database (SSURGO) maintained by the USDA-NRCS \citep{staff_gridded_2014}. For more information about SSURGO
data see SSURGO metadata\footnote{\url{http://www.nrcs.usda.gov/wps/portal/nrcs/detail/soils/survey}}.
The SSURGO database is structured by three levels of information: map units,
components, and horizons, see figure \ref{fig:ssurgo_schematic}. Horizons are the fundamental unit of soil in SSURGO, and are
therefore where the majority of soil information is stored in the database.
Components are aggregations of horizons that represent a full soil profile,
typically conforming to the Official Series Description (OSD). Map units
are discrete polygons drawn on a map (originally mapped at scales from 1:12,000
to 1:63,360) that contain one or more components that are stored non-spatially
in the database---that is, only a list of components and their percent
composition of the map unit is given. 

We chose to use the gSSURGO distribution of SSURGO. gSSURGO is a form of the SSURGO database that is packaged in a more convenient form for GIS users. The tabular data representing the components and
horizons were joined together so that each component had the data required for
the SWAT model (Table \ref{table:soil_attr_in_swat}). For all these properties, the representative value given by
SSURGO was used. For more information about these parameters see the SSURGO
metadata\footnote{\url{http://www.nrcs.usda.gov/wps/portal/nrcs/detail/soils/survey/?cid=nrcs142p2_053631}}.

HRU definition in a SWAT model is a balance of incorporating the most important
pieces of information without overloading it with redundant or insignificant
information---a modeler should represent every process that controls the system,
however an overloaded model requires more computational resources, which may not
be feasible to acquire. To reduce the number of HRUs in the model, we aggregated
soils together based on similarity of several key properties that impact the
hydrologic cycle. This was a two step process: first, components within map
units were aggregated
together\footnote{\url{https://github.com/dnrwaterqualitymodeling/wisconsinRiverTMDL/blob/master/soils/step1_aggregate_gSSURGO.R} } ,
and second, map units were aggregated together based on
similarity\footnote{\url{https://github.com/dnrwaterqualitymodeling/wisconsinRiverTMDL/blob/master/soils/step2_aggregate_gSSURGO.R}} \ref{fig:agg_flow_diagram}.

Several changes were made to the dataset before aggregation, in order to
facilitate processing. Soil organic carbon content is required by SWAT, but is
given by SSURGO as soil organic matter. The organic matter (percent) value given in SSURGO
was converted to percent organic carbon by multiplying by 50\% which is the generally accepted average carbon content of soil organic matter \citep{brady_elements_2004}. The HSG is
denoted as a letter in SSURGO, either A through D, or if the soil has different
characteristics when drained, as two letters, A/D, B/D or C/D, the latter of
which is the natural state of the soil if not artificially drained (e.g.,
through tiling or ditching) while the former is if the soil is drained. In order
to average the different components it was necessary to convert these letters
into numbers; groups A through D were converted to 1 through 4 to correspond
with increasingly wetter drainage conditions. Once a number was obtained for the
HSG, it was treated as any other soil property in the aggregation process and
then rounded to the nearest integer and converted in the same manner to a letter
once the aggregation was finished. For those components with dual HSGs, we
assumed that if half of the area in the map unit was agriculture it was drained
and the first HSG taken; conversely, if the land use was not majority agriculture
then it was assumed to not be drained and the ``D'' designation was chosen.

The first aggregation step was to aggregate components by map unit to conform to
the SWAT soils data structure. The data structure for soils in SWAT does not
directly conform to SSURGO data structure, mainly that there is no analog to the
SSURGO \textit{component} level in SWAT---in other words, soils in SWAT cannot
be subdivided, see figure \ref{fig:component_schematic}. We aggregated components by computing
component-weighted averages of each soil property for any given depth of soil from the soil surface to the average depth\cite{gatzke_aggregation_2011, beaudette_algorithms_2013}.
These averages were computed using the \texttt{slab} function in the \texttt{aqp} package in R \cite{beaudette_algorithms_2013}. We
used this algorithm to apply a depth weighted average to each horizon, while
also weighting the percent composition of each component. This achieved a robust
average of the soil properties for each horizon, while also accounting for
differing compositions of each component. The depth and number of horizons of
the aggregated soil profile produced by this algorithm must be specified before
processing. The depth was calculated by using the weighted mean of the depths of
the components, with the weights equal to the percent composition of each
component. As the number of horizons was not seen to matter as much as the
maximum depth, an arbitrary number of five horizons was chosen for the
aggregation algorithm.

Using the above aggregation method 48,585 individual soil components were
aggregated to 1,603 map units. Because the HRU used in
SWAT is derived using unique combinations of land use, slope and soil types,
this number of soil map units is still too many for efficient computation  and so
the second step of the soils data configuration was necessary to further reduce
the number of soil types.

Other researchers have aggregated soil types by their taxonomic class
\citep{gatzke_aggregation_2011} but Soil Taxonomy, the soil classification
system of the US, classifies largely based on soil morphology and not
necessarily on SWAT relevant properties. We decided that the most relevant soils
information to SWAT is hydrology data, specifically the HSG, which has a large impact on the curve number calculation. With this
consideration, aggregation was based around (and so preserved) the HSG of the
map unit. Groups of the same HSG were divided into smaller groups, hereafter
known as clusters, of homogeneous soil properties, using a clustering algorithm.
The map units within each of these clusters were then averaged together to create
an average profile for that homogeneous set of soils. These averages were then
used as the soil types for the HRU definitions and the SWAT modeling.

Each map unit was placed into one of four groups according to its hydrologic soil
group, A, B, C or D. To subdivide these groups further, a clustering algorithm
was used to objectively and robustly create clusters of map units with
homogeneous soil properties. For this purpose we used Gaussian mixture models to
assign map units to clusters. The mixture model algorithm we used was implemented within the
\texttt{Mclust} function in the mclust package \citep{fraley_mclust_2012} in R.
A mixture model is a probabilistic model for representing the presence of
subpopulations within an overall population. In our case, the overall population
would be the group of map units of like hydrologic soil groups (say all map units
with an HSG of A), while the (unknown) subpopulations are the clusters of
map units with similar distributions of soil properties (such as a cluster of
sandier soils, shallow soils or slow saturated conductivity). Using the default
settings of the function, the algorithm clustered all of the A HSG map units into
6 clusters, and all of the other HSG classes into 9 clusters.

Each of the 1603 map units had data regarding the soil property values at each
horizon. In this format it was thought that profile depth would have undue influence over the clustering algorithm, that is deep soils would cluster together and shallow soils cluster together regardless of the nature of the other properties, causing clusters to be entirely governed by
depth. To remedy this issue, depth weighted averages of the horizons were taken
to derive one value per soil property for each map unit; essentially collapsing
the soil profile down to one aggregate horizon. Profile depth was still
considered in the clustering algorithm by keeping the profile depth as a
property and so in this way it is represented but does not dominate the clustering
algorithm.

Not every map unit was included in the clustering procedure. Several of the soil property fields of the SSURGO dataset were not populated or commonly had ``no data'' values, these properties were not used in the
clustering process so the spurious zeros would not influence the algorithm (Table \ref{table:soil_attr_in_swat}). These properties were coarse fragments, calcium carbonate, and electrical conductivity. Albedo and pH were also excluded from the clustering algorithm. Mapunits that had no HSG designation were not included, nor were map units that did not have information on the soil properties of the horizons. Examining these excluded map units revealed that they were generally disturbed landscapes or those without a significant soil layer such as pits, landfills, urban or made land, rock outcrops, and water. These miscellaneous map units were all grouped together as one cluster with the exception of water, which we did not use in the cluster analysis.

The same soil profile aggregation algorithm \citep{beaudette_algorithms_2013}
used to aggregate several components together in the first step was used to combine the soil profiles of a cluster into one
composite soil profile. In this implementation each map unit was given equal
weight in the aggregation algorithm. Those map units designated as miscellaneous
were aggregated into one soil profile as the other clusters were, while the
water map units were not aggregated. The miscellaneous grouping was assigned an
HSG by converting the letter designation into an ordinal
integer (that is A, B, C, D to 1, 2, 3, 4) and the average was taken, rounded to
the nearest integer, and converted back to a letter, which happened to be B. Following SWAT convention, the water units
were given an HSG of D, and assigned an albedo of 0.23, and a saturated conductivity
of 600.

A total of 35 soil classes were distilled from this process. An example of the properties of each cluster can be seen in table \ref{table:soil_prop} and the number of map units in each cluster can be found in table \ref{tab:soil_clusterss}. 

The hydrologic soil groups and the clusters within these groups are displayed in figure \ref{fig:soil_boxplots}. This figure shows the relative variability for each soil property for each cluster.

Soil Phosphorus concentrations were obtained through the University of Wisconsin
Soil Testing Laboratory \footnote{\url{http://uwlab.soils.wisc.edu/}}. Soil
phosphorus concentrations were aggregated by county by the soil laboratory for
each year from 1974 to the present. We chose the annual average soil
concentration nearest the beginning of the model spin-up period, 1995, to
establish prior concentrations. Subbasin-level soil phosphorus concentrations
were estimated by calculating an area-weighted average of intersecting counties
within a subbasin.
The soil testing laboratory receives almost exclusively agricultural soils so to reflect this bias in the soil phosphorus data, only agricultural HRUs were given the subbasin average concentration, while the non-agricultural HRUs were given SWAT's default concentration (5 mg P/Kg). This default concentration is assumed to equilibrate over the 6-year model spin-up period. 
Soluble phosphorus
concentrations were estimated as half of the reported phosphorus using the
Bray-1 method measured with a spectrophotometer \citep{vadas_validating_2010}.
Organic phosphorus concentrations were estimated by assuming that phosphorus
constitutes 0.85\% of organic material measured by loss of weight upon ignition
(correspondence with Phillip Barak, needs citation). Soil phosphorus estimates are not included in the SWAT model provided---they will be included during the phosphorus calibration phase.
